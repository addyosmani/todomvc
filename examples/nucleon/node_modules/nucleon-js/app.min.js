/**
 * =============================
 *      Nucleon JS Framework
 * =============================
 *
 * The MIT License
 *
 * Copyright (c) 2015-2016 KÃ©vin Marcachi (git:@moduleon)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * @preserve
 */
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports!=="undefined"){module.exports=factory()}else{root.app=factory()}})(this,function(){"use strict";var version="1.1.5";var authors=["Kevin Marcachi"];function buildUrl(method,url,param){if(method==="GET"&&param){var qs="";for(var key in param){if(param.hasOwnProperty(key)){var value=param[key];qs+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"}}if(qs.length>0){qs=qs.substring(0,qs.length-1);url+=(url.indexOf("?")!==-1?"&":"?")+qs}}return url}function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}function createTransition(el,prop,startValue,endValue,duration,curveType,delay,preTransition,postTransition){function transitionEndName(){var el=document.createElement("div");var transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transitionEndEventNames){if(el.style[name]!==undefined){return transitionEndEventNames[name]}}return false}function transitionName(){var el=document.createElement("div");var transitions=["-webkit-transition","-o-transition","transition"];for(var i=0,len=transitions.length,transition;i<len;i++){transition=transitions[i];if(el.style[transition]!==undefined){return transition}}return false}function onTransitionEnd(el,callback,duration){var transitionEnd=transitionEndName();if(transitionEnd){var func=function(){app.events.removeListener(transitionEnd,el,func);if(callback){callback()}};app.events.addListener(transitionEnd,el,func)}else{setTimeout(function(){callback()},duration)}}if(isInDOM(el)===false){return}var witness="calledAt";if((el[witness]===undefined||(new Date).getTime()-el[witness]>duration)&&el.style[prop]!==undefined){el[witness]=(new Date).getTime();el.style.display="";if(preTransition){preTransition()}el.style[prop]=startValue;var transition=transitionName();var callback=function(){el.style[transition]="";delete el[witness];if(postTransition){postTransition()}};onTransitionEnd(el,callback,duration);el.style[transition]=prop+" "+duration/1e3+"s "+curveType+" "+delay/1e3+"s ";setTimeout(function(){el.style[prop]=endValue},20)}}function collapse(el,duration,callback){duration=duration||350;el.style.display="block";var originalHeight=el.offsetHeight;var preTrans=function(){el.style.overflow="hidden"};var postTrans=function(){el.style.display="none";el.style.height="";el.style.overflow="";if(callback){callback()}};createTransition(el,"height",originalHeight+"px","0px",duration,"ease",0,preTrans,postTrans)}function each(target,func){if(!target){return}if(getTypeOf(target)==="object"){var prop;for(prop in target){if(func(prop,target[prop])!==undefined){break}}}else{var i,len;for(i=0,len=target.length;i<len;i++){if(func(i,target[i],len)!==undefined){break}}}}function eachReverse(target,func){if(getTypeOf(target)==="object"){throw"eachReverse can not be used on an object."}else{for(var i=target.length-1;i>=0;i--){if(func(i,target[i])!==undefined){break}}}}function el(el){el=!isHTMLElement(el)?parseHtml(el):el;return up(el)}function escapeSelector(selector){return selector.replace(/#([0-9])/g,"#\\3$1 ").replace(/:+((?!not)[^: ]*)/g,'[type="$1"]')}function expand(el,duration,callback){duration=duration||350;el.style.display="";el.offsetHeight;var originalHeight=el.offsetHeight;var preTrans=function(){el.style.overflow="hidden"};var postTrans=function(){el.style.overflow="";el.style.height="";if(callback){callback()}};createTransition(el,"height","0px",originalHeight+"px",duration,"ease",0,preTrans,postTrans)}function fadeIn(el,duration,callback){duration=duration||150;var postTrans=function(){el.style.opacity="";if(callback){callback()}};createTransition(el,"opacity",0,1,duration,"linear",0,null,postTrans)}function fadeOut(el,duration,callback){duration=duration||150;var postTrans=function(){el.style.opacity="";el.style.display="none";if(callback){callback()}};createTransition(el,"opacity",1,0,duration,"linear",0,null,postTrans)}function find(selector,el){function nodelistToArray(list){var array=[];each(list,function(i,item){array.push(item)});return array}var query=selector.indexOf("#")!==-1&&selector.indexOf(" ")===-1?"querySelector":"querySelectorAll";var result=[];el=el&&typeof el[query]!=="undefined"?el:document.documentElement;try{result=el[query](selector)}catch(e){selector=escapeSelector(selector);try{result=el[query](selector)}catch(e){result=[]}}return query==="querySelector"?result:nodelistToArray(result)}function first(selector,el){var result=find(selector,el);return getTypeOf(result)==="array"?result[0]:result}function formToObject(form){var values={};up(form).find("[name]").forEach(function(child){if(child.value&&!child.disabled){values[child.name]=child.value}});return values}function getTypeOf(value){return Object.prototype.toString.call(value).replace("[object ","").replace("]","").toLowerCase()}function guessValueOf(string,context){string=(""+string).trim();if(!string){return""}if(context&&getTypeOf(context)!=="object"){throw"Context must be an object"}function accessProperty(path,params){path=path.split(".");var target=context?context[path[0]]:null;if(context&&context[path[0]]){target=context}else if(window[path[0]]){target=window}else{return}var owner=target;each(path,function(key,prop){if(target[prop]!==undefined){if(target!==owner){owner=target}target=target[prop]}else{target=undefined;return false}});if(getTypeOf(target)==="function"){target=target.apply(owner,params)}return target}var treated={};function saveResult(result){treated[""+result]=result}function wrapAndEscape(str){return'"'+str.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"'}var ARRAY_START="[";var ARRAY_END="]";var DOUBLE_QUOTE='"';var ESCAPER="\\";var OBJECT_START="{";var OBJECT_END="}";var SEPARATOR=",";var SINGLE_QUOTE="'";var SPACE=" ";function treatParenthesis(){var PARENTHESIS=/(?:(?!(?:[a-zA-Z0-9\.\_'"])).|^)(\([^\(\)]*\))/;var search;var result;while(search=string.match(PARENTHESIS)){result=guessValueOf(search[1].substr(1,search[1].length-2),context);saveResult(result);string=string.replace(search[1],result)}return string}function treatFunctions(){function extractParams(string){if(!string)return[];var params=[""];var index=0;var openObjects=0;var openArrays=0;each(string,function(i,k){switch(k){case ARRAY_START:openArrays++;break;case ARRAY_END:openArrays--;break;case OBJECT_START:openObjects++;break;case OBJECT_END:openObjects--;break;case SEPARATOR:if(!openArrays&&!openObjects){index++;params[index]=k=""}}if(params[index]!==""||k!==" "){params[index]+=k}});params=params.map(function(param){return guessValueOf(param,context)});return params}var FUNCTIONS=/[a-zA-Z0-9\.\_]+\(+((?![a-zA-Z0-9\.\_]+\(\)).)*?\)+/;var PARAMS=/\((.*)?\)/;var search;var result;var fn;var params;var BLACKLIST=["eval","alert","console.log","setTimeout"];while(search=string.match(FUNCTIONS)){params=search[0].match(PARAMS);fn=search[0].substr(0,search[0].length-params[0].length);if(BLACKLIST.indexOf(fn)!==-1){throw"Nice try. "+fn+" can not be run with guessValueOf."}params=params?extractParams(params[1]):[];result=accessProperty(fn,params);saveResult(result);if(getTypeOf(result)==="string"){result=wrapAndEscape(result)}string=string.replace(search[0],result)}return string||""}function treatComponents(){function stringToValue(str){function stringToObject(str){var components=[""];var index=0;var inDoubleQuote=false;var inSingleQuote=false;function addRowIfNeeded(i,value){value=value||"";if(components[index]!==""){if(components[index]!=="}"&&components[index]!=="]"){if(value===","||value==="}"||value==="]"){components[index]=stringToValue(components[index]);var type=getTypeOf(components[index]);if(type==="string"){components[index]=wrapAndEscape(components[index])}else if(type==="array"||type==="object"){components[index]=JSON.stringify(components[index])}}}index++}components[index]=value}each(str,function(i,k){switch(k){case ARRAY_START:case ARRAY_END:case OBJECT_START:case OBJECT_END:case SEPARATOR:case":":if(inSingleQuote===false&&inDoubleQuote===false){addRowIfNeeded(i,k);addRowIfNeeded(i);k=""}break;case DOUBLE_QUOTE:if(inSingleQuote===false){inDoubleQuote=inDoubleQuote===false?true:false}break;case SINGLE_QUOTE:if(inDoubleQuote===false){inSingleQuote=inSingleQuote===false?true:false}break;case SPACE:if(inSingleQuote===false&&inDoubleQuote===false){k=""}break}if(k){components[index]+=k}});if(components[index]===""){components.splice(index,1)}return JSON.parse(components.join(""))}if(getTypeOf(str)==="string"){if(treated[str]){return treated[str]}else if(str[0]==='"'&&str[str.length-1]==='"'||str[0]==="'"&&str[str.length-1]==="'"){return str.substr(1,str.length-2)}else{switch(str){case"undefined":return undefined;case"null":return null;case"false":return false;case"true":return true;default:var value;if(str[0]===OBJECT_START||str[0]===ARRAY_START){try{value=stringToObject(str)}catch(e){value=str}}else{value=parseFloat(str);if(isNaN(value)){if(!SYMBOLS[str]){value=accessProperty(str)}else{value=str}}}return value}}}return string}var SYMBOLS={"*":function(index){return components[index-1]*components[index+1]},"/":function(index){return components[index-1]/components[index+1]},"%":function(index){return components[index-1]%components[index+1]},"-":function(index){return(components[index-1]||0)-components[index+1]},"+":function(index){return(components[index-1]||0)+components[index+1]},"!":{},"!=":function(index){return components[index-1]!==components[index+1]},"=":{},"==":function(index){return components[index-1]===components[index+1]},">":function(index){return components[index-1]>components[index+1]},">=":function(index){return components[index-1]>=components[index+1]},"<":function(index){return components[index-1]<components[index+1]},"<=":function(index){return components[index-1]<=components[index+1]},"&":{},"&&":function(index){return components[index-1]&&components[index+1]},"|":{},"||":function(index){return components[index-1]||components[index+1]}};var components=[""];var index=0;var inEscaper=false;var inDoubleQuote=false;var inSingleQuote=false;var inSymbol=false;var openArrays=0;var openObjects=0;function addRowIfNeeded(value){value=value||"";if(components[index]){components[index]=stringToValue(components[index]);index++}components[index]=value}each(string,function(i,k){switch(k){case DOUBLE_QUOTE:if(inSingleQuote===false&&inEscaper===false&&openObjects===0&&openArrays===0){inDoubleQuote=inDoubleQuote===false?true:false}break;case SINGLE_QUOTE:if(inDoubleQuote===false&&inEscaper===false&&openObjects===0&&openArrays===0){inSingleQuote=inSingleQuote===false?true:false}break;case SPACE:if(inSingleQuote===false&&inDoubleQuote===false&&openObjects===0&&openArrays===0){k=""}break;case ESCAPER:inEscaper=inEscaper===false?true:false;if(inEscaper){k=""}break;case ARRAY_START:openArrays++;break;case ARRAY_END:openArrays--;break;case OBJECT_START:openObjects++;break;case OBJECT_END:openObjects--;break}if(k){if(SYMBOLS[k]&&inSingleQuote===false&&inDoubleQuote===false&&openObjects===0&&openArrays===0){if(inSymbol){components[index]+=k}else{addRowIfNeeded(k);inSymbol=true}}else{if(inSymbol){addRowIfNeeded(k);inSymbol=false}else{components[index]+=k}}inEscaper=false}});if(components[index]!==""){components[index]=stringToValue(components[index])}else{components.splice(index,1)}var from,range,value;each(SYMBOLS,function(symbol,func){while((index=components.indexOf(symbol))>-1){from=index-1>=0?index-1:index;range=index===from?2:3;value=func(index);components.splice(from,range,value)}});components=components.length>1?components.join(" "):components[0];string=components}treatParenthesis();treatFunctions();treatComponents();return string}function hydrate(obj,args,force){if(getTypeOf(obj)==="object"&&getTypeOf(args)==="object"){each(args,function(prop,value){if(typeof obj[prop]!=="undefined"||force){var setter="set"+capitalize(prop);if(getTypeOf(obj[setter])==="function"){obj[setter](value)}else{if(getTypeOf(obj[prop])==="object"&&getTypeOf(value)==="object"){hydrate(obj[prop],value)}else{obj[prop]=value}}}})}return obj}function isHTMLElement(el){try{return el instanceof HTMLElement||el.nodeType===3}catch(e){return typeof el==="object"&&(el.nodeType===1||el.nodeType===3)&&typeof el.style==="object"&&typeof el.ownerDocument==="object"}}function isInDOM(element){return element.parentNode!==null&&element.parentNode.innerHTML!==null&&up(element).ancestor("html")!==false}function overrideArrayItemsMethod(ary,callback){var methods=["pop","push","shift","splice","unshift"];each(methods,function(key,method){(function(ary,method,callback){ary[method]=function(){Array.prototype[method].apply(ary,arguments);if(callback){callback()}}})(ary,method,callback)})}function parseHtml(string){function escapeNestedQuotes(string){var escaped="";var inTag=false;var inQuote=false;each(string,function(i,k){if((k==="<"||k===">")&&!inQuote){inTag=inTag?false:true}if(inTag){if(k==='"'){if(inQuote){if(string[i+1]===" "||string[i+1]===">"){inQuote=false}else{k="&quot;"}}else{inQuote=true}}}escaped+=k});return escaped}function escapeCodesTag(str){var ALL_TAGS_PATTERN=/<code[ a-z\"\'\-\_\=|]*>(?:(?!<code).|[\r\n])*<\/code>/gi;var codes=str.match(ALL_TAGS_PATTERN);if(codes){var INNER_TAG_PATTERN=/<code[ a-z\"\'\-\_\=|]*>((?:(?!<code).|[\r\n])*)<\/code>/i;each(codes,function(key,code){var inner=code.match(INNER_TAG_PATTERN)[1];var escaped=code.replace(inner,inner.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;"));str=str.replace(code,escaped)})}return str}string=escapeCodesTag(string);var COMMENTS=/<!--[^>]*-->/g;string=string.replace(COMMENTS,"");string=string.trim();string=escapeNestedQuotes(string);var temp=document.createElement("div");temp.innerHTML=string;var el=temp.firstChild.cloneNode(true);temp=null;return el}function redirect(url,inHistory){var btn=parseHtml('<a href="'+url+'">moduleon</a>');var e={preventDefault:function(){},target:btn};return controllers.delegate(e,inHistory)}function request(params){if(!params["url"]){throw"No url given."}function getMethod(method){if(!method){return"GET"}var authorized=["GET","POST","PUT","DELETE"];if(authorized.indexOf(method)===-1){throw"Unauthorized method."}return method}function getData(method,data){if(data&&(method==="POST"||method==="PUT")){return data}return null}function getFormat(format){if(!format){return null}var authorized=["JSON"];if(authorized.indexOf(format)===-1){throw"Unauthorized requested format."}return format}function handleFormat(format,response){if(format&&format==="JSON"){response=JSON.parse(response)}return response}var that=this,method=getMethod(params["method"]),url=buildUrl(method,params["url"],params["data"]),data=getData(method,params["data"]),headers=params["headers"]||{},format=getFormat(params["format"]),cors=params["cors"]||false,async=params["async"]===false?params["async"]:true,store=params["store"]||false,success=params["success"]||function(){},error=params["error"]||function(){};if(method==="GET"){var response=pager.getResponse(url);if(response){response=handleFormat(format,response);return success?success(response,200):response}}var request=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");if(cors===true){if("withCredentials"in request){}else{if(typeof XDomainRequest!=="undefined"){request=new XDomainRequest}else{throw"Your browser does not support all ajax features needed for CORS."}}}request.open(method,url,async);if(request.setRequestHeader){request.setRequestHeader("X-Requested-With","XMLHttpRequest");if(method==="POST"||method==="PUT"){request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}for(var key in headers){request.setRequestHeader(key,headers[key])}}if(async===false){request.send(null);if(request.status>=200&&request.status<400){var response=handleFormat(format,request.responseText);return success?success(response,200):response}else{if(error){return error(handleFormat(format,request.responseText),request.status)}else{throw"Server returned an error."}}}if(request.onprogress){request.onprogress=function(){}}if(request.ontimeout){request.ontimeout=function(){}}request.onreadystatechange=function(){if(request.readyState>3){if(request.status>=200&&request.status<400){if(store&&method==="GET"){that.pager.addResponse(url,request.responseText)}var response=handleFormat(format,request.responseText);return success?success(response,200):response}else{if(error){error(handleFormat(format,request.responseText),request.status)}else{throw"Server returned an error."}}}};request.onerror=function(){if(error){error(handleFormat(format,request.responseText),request.status)}else{throw"Server returned an error."}};setTimeout(function(){request.send(data)},0)}function selectorMatches(el,selector){var result=false;if(isHTMLElement(el)){var match=HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.msMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.oMatchesSelector||null;if(match){try{result=match.call(el,selector)}catch(e){selector=escapeSelector(selector);try{result=match.call(el,selector)}catch(e){result=false}}}}return result}function watchObject(obj,handler,path){function redefineProperty(obj,prop,getter,setter){if(typeof Object.prototype.defineProperty==="function"){Object.defineProperty(obj,prop,{configurable:true,enumerable:true,get:getter,set:setter})}else if(Object.prototype.__defineGetter__&&Object.prototype.__defineSetter__){Object.prototype.__defineGetter__.call(obj,prop,getter);Object.prototype.__defineSetter__.call(obj,prop,setter)}}function watchProperty(obj,prop,handler){var value=obj[prop];var oldValue=value;if(delete obj[prop]){if(getTypeOf(value)==="array"){watchArray(value,function(){handler.call(obj,prop,oldValue,value)})}var getter=function(){return value};var setter=function(newValue){oldValue=value;value=newValue;if(oldValue!==newValue){if(getTypeOf(newValue)==="array"){watchArray(value,function(){handler.call(obj,prop,oldValue,newValue)})}handler.call(obj,prop,oldValue,newValue)}};redefineProperty(obj,prop,getter,setter)}}function watchArray(ary,callback){overrideArrayItemsMethod(ary,callback)}function handleObjectOrArray(obj,handler,path,value,valueType){valueType=valueType||getTypeOf(value);switch(valueType){case"array":each(value,function(key){watchObject(value[key],handler,path+"."+key)});break;case"object":watchObject(value,handler,path);break}return obj}if(getTypeOf(obj)==="object"){var actualPath="";var valueType;each(obj,function(prop,value){valueType=getTypeOf(value);if(valueType!=="function"){actualPath=(path?path+".":"")+prop;(function(obj,prop,actualPath,value,valueType,handler){watchProperty(obj,prop,function(prop,oldValue,newValue){if(valueType==="object"||valueType==="array"){handleObjectOrArray(obj,handler,actualPath,newValue)}handler(actualPath,oldValue,newValue)});if(valueType==="object"||valueType==="array"){handleObjectOrArray(obj,handler,actualPath,value,valueType)}})(obj,prop,actualPath,value,valueType,handler)}})}return obj}function unwatchObject(obj){function unwatchProperty(obj,prop){switch(getTypeOf(obj[prop])){case"object":unwatchObject(obj[prop]);break;case"array":unwatchArray(obj[prop]);break;default:var value=obj[prop];delete obj[prop];obj[prop]=value}}function unwatchArray(ary){overrideArrayItemsMethod(ary);each(ary,function(key,item){unwatchObject(item)})}each(obj,function(prop){unwatchProperty(obj,prop)});return obj}function up(el){if(el.upped===undefined){if(isHTMLElement(el)){if(typeof el.hasClass!=="function"){el.hasClass=function(className){return!this.className?false:new RegExp("(^|\\s)"+className+"(\\s|$)").test(this.className)}}if(typeof el.addClass!=="function"){el.addClass=function(className){this.className=this.className+(this.hasClass(className)===false?(this.className?" ":"")+className:"");return this}}if(typeof el.removeClass!=="function"){el.removeClass=function(remove){var classNames=this.className.split(" ");this.className="";for(var i=0,len=classNames.length;i<len;i++){if(classNames[i]!==remove){this.className+=(this.className?" ":"")+classNames[i]}}return this}}if(typeof el.css!=="function"){el.css=function(attributes){if(attributes){var name;for(name in attributes){if(typeof this.style[name]!=="undefined"){this.style[name]=attributes[name]}}}if(!el.getAttribute("style")){el.removeAttribute("style")}return this}}if(typeof el.hide!=="function"){el.hide=function(){return this.css({display:"none"})}}if(typeof el.show!=="function"){el.show=function(){return this.css({display:""})}}if(typeof el.fadeIn!=="function"){el.fadeIn=function(duration,callback){fadeIn(el,duration,callback)}}if(typeof el.fadeOut!=="function"){el.fadeOut=function(duration,callback){fadeOut(el,duration,callback)}}if(typeof el.collapse!=="function"){el.collapse=function(duration,callback){collapse(el,duration,callback)}}if(typeof el.expand!=="function"){el.expand=function(duration,callback){expand(el,duration,callback)}}if(typeof el.html!=="function"){el.html=function(element){while(el.firstChild){el.removeChild(el.firstChild)}if(element=!isHTMLElement(element)?parseHtml(element):element){this.appendChild(element)}return this}}if(typeof el.before!=="function"){el.before=function(element){if(element=!isHTMLElement(element)?parseHtml(element):element){this.parentNode.insertBefore(element,this)}return this}}if(typeof el.after!=="function"){el.after=function(element){if(element=!isHTMLElement(element)?parseHtml(element):element){this.nextSibling?this.parentNode.insertBefore(element,this.nextSibling):this.parentNode.appendChild(element)}return this}}if(typeof el.prepend!=="function"){el.prepend=function(element){if(element=!isHTMLElement(element)?parseHtml(element):element){this.insertBefore(element,this.firstChild)}return this}}if(typeof el.append!=="function"){el.append=function(element){if(element=!isHTMLElement(element)?parseHtml(element):element){this.appendChild(element)}return this}}if(typeof el.replaceWith!=="function"){el.replaceWith=function(element){if(element=!isHTMLElement(element)?parseHtml(element):element){this.parentNode.replaceChild(element,this)}return element}}if(typeof el.remove!=="function"){el.remove=function(){this.parentNode.removeChild(this)}}if(typeof el.find!=="function"){el.find=function(selector){return find(selector,this)}}if(typeof el.matches!=="function"){el.matches=function(){return selectorMatches(this,selector)}}if(typeof el.ancestor!=="function"){el.ancestor=function(selector){var parent=this.parentNode;while(parent){if(selectorMatches(parent,selector)){return parent}parent=parent.parentNode}return false}}if(typeof el.toObject!=="function"){el.toObject=function(){if(this.tagName==="FORM"){return formToObject(this)}}}el.upped=true}}return el}var Action=function(name,args){this.name=name;this.route=null;this.history=true;this.fn=null;this.setRoute=function(args){if(typeof args==="object"){this.route=new Route(args);return this}throw"Valid object has to be given for the route attached to the action."};this.setHistory=function(bool){if(typeof bool==="boolean"){this.history=bool;return this}throw"History must be a boolean."};this.setFn=function(fn){if(typeof fn==="function"){this.fn=fn;return this}throw"Invalid function."};this.run=function(e,url,method){if(this.history===true){var that=this;var params=method==="POST"?formToObject(e.target):null;historic.addEntry(buildUrl("GET",url,params),function(){that.fn.call(that,e,that.route.extractParamsFromUrl(url))})}if(this.fn.call(this,e,this.route.extractParamsFromUrl(url))===false){return false}};return hydrate(this,args)};var Controller=function(name){this.name=name;var actions={};this.addAction=function(name,args){if(getTypeOf(args)!=="object"){throw"Arguments to add an action must be a JSON."}if(!name){throw"Action must have a name"}else if(actions[name]){throw"Action with name "+name+" has already been registered in controller "+this.name}var action=new Action(name,args);if(this.hasMatchingAction(action.route.regexUrl,action.route.method)){throw"An action with the same url and mode has already been defined for this controller."}actions[name]=action;return this};this.hasMatchingAction=function(url,method){if(actions){for(var name in actions){if(actions[name].route.match(url,method)){return actions[name]}}}return false};return this};var Model=function(model){var publish=true;var pubsub=new PubSub;var subscriptions=[];var that=this;hydrate(this,model,true);function subscribeToOuterChanges(obj,handler,path){var actualPath="";var valueType;each(obj,function(prop,value){valueType=getTypeOf(value);if(valueType!=="function"){actualPath=(path?path+".":"")+prop;(function(value,actualPath,handler){switch(valueType){case"array":var itemType;each(value,function(i,item){itemType=getTypeOf(item);if(itemType==="array"||itemType==="object"){subscribeToOuterChanges(item,handler,actualPath+"."+i)}});break;case"object":subscribeToOuterChanges(value,handler,actualPath);break;default:var message=actualPath+":change";if(subscriptions.indexOf(message)===-1){pubsub.subscribe(message,function(msg,oldValue,newValue){handler(actualPath,oldValue,newValue)});subscriptions.push(message)}}})(value,actualPath,handler)}})}function setPropertyValue(path,value){var target=that;each(path.split("."),function(i,prop,len){if(getTypeOf(target[prop])!=="undefined"){if(i+1<len){target=target[prop]}else{target[prop]=value}}})}watchObject(this,function(path,oldValue,newValue){var valueType=getTypeOf(newValue);if(valueType==="array"||valueType==="object"){subscribeToOuterChanges(newValue,function(path,oldValue,newValue){publish=false;setPropertyValue(path,newValue)},path)}if(publish){pubsub.publish(path+":change",oldValue,newValue)}publish=true});subscribeToOuterChanges(this,function(path,oldValue,newValue){publish=false;setPropertyValue(path,newValue)});this.hydrate=function(args){hydrate(this,args)};this.getPubsub=function(){return pubsub};this.hasProperty=function(path){var target=this;var result=true;each(path.split("."),function(i,prop){if(target[prop]!==undefined){target=target[prop]}else{return result=false}});return result};return this};var PubSub=function(){var callbacks={};this.subscribe=function(msg,callback){callbacks[msg]=callbacks[msg]||[];if(callbacks[msg].indexOf(callback)===-1){callbacks[msg].push(callback)}};this.unsubscribe=function(msg,callback){callbacks[msg]=callbacks[msg]||[];var index=callbacks[msg].indexOf(callback);if(index!==-1){callbacks[msg].splice(index,1)}};this.publish=function(msg){callbacks[msg]=callbacks[msg]||[];for(var i=0,len=callbacks[msg].length;i<len;i++){callbacks[msg][i].apply(this,arguments)}}};var Route=function(args){this.url=null;this.regexUrl=null;this.params={};this.method="GET";this.setUrl=function(url){if(typeof url==="string"){this.url=url;return this}throw"Invalid url."};this.setRegexUrl=function(){if(this.regexUrl=this.url){var key,marker;if(this.regexUrl.indexOf(window.location.host)===-1){this.regexUrl=window.location.host+this.regexUrl}this.regexUrl=this.handleOptional(this.regexUrl);for(key in this.params){marker="{"+key+"}";if(this.regexUrl.indexOf(marker)===-1){throw"Invalid number of params for url "+this.url}this.regexUrl=this.regexUrl.replace(marker,this.params[key])}this.regexUrl+="$";return this}};this.setParams=function(params){var shortcuts={number:"[0-9]*",word:"[a-zA-Z0-9%]*"};if(typeof params==="object"){each(params,function(prop,value){if(shortcuts[value]){params[prop]=shortcuts[value]}});this.params=params;return this}throw"Params must be an object."};this.handleOptional=function(url){url=url.replace(/\?/g,"\\?");url=url.replace(/\(([^\(\)]*)\)/g,"(?:$1)?");return url};this.extractParamsFromUrl=function(url){var params={},that=this,regexUrl=this.handleOptional(this.url),tempUrl,prop,value,props=[];for(prop in this.params){props.push(prop)}for(prop in this.params){tempUrl=regexUrl;for(var i=0,len=props.length;i<len;i++){tempUrl=tempUrl.replace("{"+props[i]+"}",props[i]===prop?"("+that.params[props[i]]+")":that.params[props[i]])}if(value=new RegExp(tempUrl).exec(url)[1]){params[prop]=value}}return params};this.setMethod=function(method){if(method==="GET"||method==="POST"||method==="GET|POST"||method==="POST|GET"){this.method=method;return this}throw"Invalid method"};this.match=function(url,method){return(new RegExp(this.regexUrl).test(url)||url===this.regexUrl)&&new RegExp(this.method).test(method)};hydrate(this,args);this.setRegexUrl();return this};var View=function(params){var context=params.context||modelStorage;function createTemplate(string){return el(escapeSrc(string))}function escapeSrc(str){return str.replace(/src="/g,'src="#')}function unescapeSrc(str){return str.replace(/^#/,"")}function bindContext(element,references,subscriptions){if(!element){return}references=references||{};subscriptions=subscriptions||[];function extractMarkers(string){if(string){var MARKERS=/\{\{((?!\{\{|\}\}).)*\}\}/g;var DELIMITERS=/\{\{|\}\}/g;var markers=string.match(MARKERS);if(markers&&markers.length>0){markers=markers.map(function(marker){return{outer:marker,inner:marker.replace(DELIMITERS,"").trim()}});return markers.length>0?markers:[]}}return[]}function extractModelProps(string){string=(""+string).trim();var PROPERTY=/[a-zA-Z0-9\._]*/g;var props=string.match(PROPERTY);props=props.map(function(prop){if(prop){prop=replaceReferences(prop);prop=findModelFromProp(prop)?prop:"";prop=prop.replace(".length","").trim()}return prop});var returned={};return props.filter(function(prop){if(prop){if(!returned[prop]){returned[prop]=1}else{returned[prop]++}if(returned[prop]===1){return true}}return false})}function getValueOf(expr){if(references){expr=replaceReferences(expr)}var result=guessValueOf(expr,context);return result===undefined?"":result}function findModelFromProp(prop){prop=prop.split(".");return context[prop[0]]}function replaceReferences(prop){if(references){each(references,function(reference,realProp){if(reference===prop){prop=realProp;return false}else{var pattern="([.(|])*("+reference+")([.)|])";prop=prop.replace(new RegExp(pattern,"g"),function(match,$1,$2,$3){return($1?$1:"")+realProp+($3?$3:"")})}})}return prop}function initAndHandleChanges(prop,initFunc){initFunc(getValueOf(prop));subscribeToChanges(prop,initFunc)}function getMsgFromProp(prop){return prop.replace(/^[a-zA-Z0-9]+\.+/,"")+":change"}function subscribeToChanges(prop,func){var model=findModelFromProp(prop);if(model){var msg=getMsgFromProp(prop);var callback=function(msg,oldValue,newValue){func(newValue)};model.getPubsub().subscribe(msg,callback);if(references){subscriptions.push({msg:msg,callback:callback,model:model})}}}function unsubscribeToChanges(subscription){subscription.model.getPubsub().unsubscribe(subscription.msg,subscription.callback)}function unsubscribeItem(itemSubscriptions){each(itemSubscriptions,function(i,subscription){if(getTypeOf(subscription)==="object"){unsubscribeToChanges(subscription)}else{unsubscribeItem(subscription)}})}var ELEMENT_NODE=1;var TEXT_NODE=3;switch(element.nodeType){case ELEMENT_NODE:var attr;if(attr=element.getAttribute("data-no-bind")){element.removeAttribute("data-no-bind");return}if(attr=element.getAttribute("data-loop")){var LOOP_REF=/ in .*/g;var LOOP_OUTPUT=/.* in /g;var from;var insertMethod;if(from=element.nextSibling){insertMethod="before"}else if(from=element.previousSibling){insertMethod="after"}else if(from=element.parentNode){insertMethod="append"}up(from);element.removeAttribute("data-loop");element.parentNode.removeChild(element);var prop=replaceReferences(attr.replace(LOOP_OUTPUT,""));var output=attr.replace(LOOP_REF,"");var loopMethod=insertMethod==="after"?eachReverse:each;var loopElements=[];var loopItems=[];var itemsSubscriptions=[];initAndHandleChanges(prop,function(items){if(items.length===0){each(loopElements,function(i,child){stage.handleLeaving(child,function(){
child.parentNode.removeChild(child)})});loopElements=[];loopItems=[];unsubscribeItem(itemsSubscriptions);itemsSubscriptions=[];return}var index=loopItems.length;each(loopItems,function(i,loopItem){if(items.indexOf(loopItem)===-1){index=i;return false}});var temporaryRemoved=[];eachReverse(loopItems,function(i,item){if(i>=index){if(items.indexOf(item)===-1){var itemElement=loopElements[i];stage.handleLeaving(itemElement,function(){itemElement.parentNode.removeChild(itemElement)})}else{loopElements[i].parentNode.removeChild(loopElements[i]);temporaryRemoved.push(loopItems[i])}unsubscribeItem(itemsSubscriptions[i]);loopElements.splice(i,1);loopItems.splice(i,1)}});loopMethod(items,function(i,item){if(loopItems.indexOf(item)===-1){if(references[output]){references=JSON.parse(JSON.stringify(references))}references[output]=prop+"."+i;var itemSubscriptions=[];itemsSubscriptions.push(itemSubscriptions);var child=bindContext(element.cloneNode(true),references,itemSubscriptions);from[insertMethod](child);if(temporaryRemoved.indexOf(item)===-1){stage.handleEntering(child)}loopElements.push(child);loopItems.push(item)}})});return}if(attr=element.getAttribute("data-bind")){var tag=element.tagName.toLowerCase();var prop=replaceReferences(attr);var model=findModelFromProp(prop);if(tag==="input"||tag==="textarea"||tag==="select"){var msg=getMsgFromProp(prop);if(tag==="select"||tag==="input"&&(element.type==="radio"||element.type==="checkbox")){var clickEvent=element.getAttribute("data-click");events.addListener("change",element,function(e){var target=e.target||e.srcElement;var value=target.value;if(target.type==="checkbox"&&value==="on"){value=target.checked?true:false}var actualValue=value;if(clickEvent){getValueOf(clickEvent);actualValue=target.value;if(target.type==="checkbox"&&value==="on"){actualValue=target.checked?true:false}}if(value===actualValue){model.getPubsub().publish(msg,null,value)}});if(clickEvent){element.removeAttribute("data-click")}}else{var enterEvent=element.getAttribute("data-enter");(function(enterEvent){if("oninput"in element){if(enterEvent){events.addListener("keypress",element,function(e){if(e.which===13){e.preventDefault();var target=e.target||e.srcElement;if(target.value){target.value=target.value+" ";model.getPubsub().publish(msg,null,target.value)}getValueOf(enterEvent)}})}events.addListener("input",element,function(e){var target=e.target||e.srcElement;model.getPubsub().publish(msg,null,target.value)})}else{events.addListener("keyup, keypress",element,function(e){var target=e.target||e.srcElement;if(enterEvent&&e.which===13){e.preventDefault();if(target.value){target.value=target.value+" ";model.getPubsub().publish(msg,null,target.value)}getValueOf(enterEvent);return}model.getPubsub().publish(msg,null,target.value)})}})(enterEvent)}}initAndHandleChanges(prop,function(value){if(tag==="input"||tag==="textarea"||tag==="select"){if(element.type==="radio"||element.type==="checkbox"){if(value===true||value===element.value){element.checked="checked"}else{element.checked=""}}else{element.value=value}}else{element.innerHTML=value}});element.removeAttribute("data-bind")}if(attr=element.getAttribute("data-show")){each(extractModelProps(attr),function(i,prop){var expr=attr;initAndHandleChanges(prop,function(){up(element);if(getValueOf(expr)===true){element.show();stage.handleEntering(element)}else{element.hide();stage.handleLeaving(element)}})});element.removeAttribute("data-show")}if(attr=element.getAttribute("data-click")){(function(attr){events.addListener("click",element,function(e){getValueOf(attr)})})(attr);element.removeAttribute("data-click")}if(attr=element.getAttribute("data-double-click")){(function(attr){events.addListener("dblclick",element,function(e){getValueOf(attr)})})(attr);element.removeAttribute("data-double-click")}if(attr=element.getAttribute("data-submit")){(function(attr){events.addListener("submit",element,function(e){getValueOf(attr)})})(attr);element.removeAttribute("data-submit")}if(attr=element.getAttribute("data-effect-in")){stage.effectIn(element,attr);element.removeAttribute("data-effect-in")}if(attr=element.getAttribute("data-effect-out")){stage.effectOut(element,attr);element.removeAttribute("data-effect-out")}if(element.attributes){each(element.attributes,function(i,attr){var content=attr.value;if(content){var markers=extractMarkers(content);if(markers.length>0){var updateAttr=function(){attr.value=content;each(markers,function(i,marker){attr.value=attr.value.replace(marker.outer,getValueOf(marker.inner));if(attr.name==="src"){attr.value=unescapeSrc(attr.value)}})};updateAttr();each(extractModelProps(content),function(i,prop){subscribeToChanges(prop,updateAttr)})}else{if(attr.name==="src"){attr.value=unescapeSrc(attr.value)}}}})}break;case TEXT_NODE:var textContent=element.textContent?"textContent":"nodeValue";var content=element[textContent];if(content){var markers=extractMarkers(content);if(markers.length>0){var updateContent=function(){element[textContent]=content;each(markers,function(i,marker){element[textContent]=element[textContent].replace(marker.outer,getValueOf(marker.inner))})};updateContent();each(extractModelProps(content),function(i,prop){subscribeToChanges(prop,updateContent)})}}break}if(element.childNodes&&element.childNodes.length>0){each(element.childNodes,function(i,child){bindContext(child,references,subscriptions)})}return element}var parentView;var root;var template;var templateUrl;function getRoot(){root=getTypeOf(root)==="string"?first(root):root;return up(root)}each(params,function(prop,value){switch(prop){case"root":root=value;break;case"template":template=createTemplate(data);break;case"templateUrl":templateUrl=getTypeOf(value)==="string"?value:undefined;break}});this.childOf=function(viewInstance){if(viewInstance instanceof View===false){throw"A view can only extend another view."}else if(viewInstance===this){throw"A view can not extend itself."}parentView=viewInstance;return this};this.isRendered=function(){return template!==undefined&&isInDOM(template)};this.render=function(preTransition,postTransition){function tryIntegrate(){root=getRoot();if(root){if(root.firstChild!==template){stage.handleLeaving(root.firstChild,function(){root.html(template.show());if(preTransition){setTimeout(function(){preTransition()},0)}stage.handleEntering(template,postTransition)})}else{if(preTransition){setTimeout(function(){preTransition()},0)}if(postTransition){setTimeout(function(){postTransition()},0)}}}else{throw"Root was not found."}}if(template){if(isInDOM(template)===false){if(parentView&&parentView.isRendered()===false){parentView.render(function(){tryIntegrate()})}else{tryIntegrate()}}else{tryIntegrate()}}else{if(templateUrl){var that=this;request({method:"GET",url:templateUrl,data:{t_ref:(new Date).getTime()},async:false,success:function(data){template=createTemplate(data);bindContext(template);that.render(preTransition,postTransition)},error:function(){throw"Template "+templateUrl+" could not be loaded."}});return}throw"No template or templateUrl has been given for the view."}}};var initStorage=[];var channel=new PubSub;var events=new function(){var dom=document;var listeners={};var that=this;function hasListener(evt){return typeof listeners[evt]!=="undefined"}function extractEvents(evt){return evt.split(",").map(function(a){return a.trim()})}function createEvent(type){var event;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent(type,true,true)}else{event=document.createEventObject();event.eventType=type}event.eventName=type;return event}function dispatchEvent(event,element){if(document.createEvent){element.dispatchEvent(event)}else{element.fireEvent("on"+event.eventType,event)}}function duplicateEvent(e){function findRealElement(el){if(el.nodeType!==1||el.tagName!=="INPUT"&&el.tagName!=="TEXTAREA"&&el.tagName!=="SELECT"&&!el.innerHTML){while(el.nodeType!==1||el.tagName!=="INPUT"&&el.tagName!=="TEXTAREA"&&el.tagName!=="SELECT"&&!el.innerHTML){el=el.parentNode}}else{if(el.parentNode.tagName==="A"||el.parentNode.tagName==="BUTTON"){el=el.parentNode}}return el}var copy={};for(var prop in e){copy[prop]=e[prop]}copy.returnValue=null;copy.preventDefault=function(){e.preventDefault?e.preventDefault():e.returnValue=false;this.returnValue=false};copy.target=copy.srcElement=findRealElement(e.target||e.srcElement);return copy}function hasTarget(evt,selector,fn){for(var i=0,len=listeners[evt].length;i<len;i++){if(selector===listeners[evt][i].selector&&fn===listeners[evt][i].fn){return listeners[evt][i]}}return false}function buildTarget(selector,fn){return{selector:selector,fn:fn}}function getAllTargets(evt,selector){var targets=[];each(listeners[evt],function(i,target){if(target.selector===selector){targets.push(target)}});return targets}function delegate(e){if(listeners[e.type]!==undefined){var event=duplicateEvent(e);each(listeners[e.type],function(i,target){if(selectorMatches(event.target,target.selector)){target.fn.call(event.target,event);if(event.returnValue===false){return false}}})}}this.addListener=function(evt,el,fn){each(extractEvents(evt),function(i,e){if(el.addEventListener){el.addEventListener(e,fn,false)}else if(el.attachEvent){el.attachEvent("on"+e,function(){return fn.call(window.event.srcElement,window.event)})}else{throw"Given element can not have a listener."}})};this.removeListener=function(evt,el,fn){each(extractEvents(evt),function(i,e){if(el.removeEventListener){el.removeEventListener(e,fn,false)}else if(el.detachEvent){el.detachEvent("on"+e,function(){return fn.call(window.event.srcElement,window.event)})}})};this.on=function(evt,selector,fn){each(extractEvents(evt),function(i,e){if(!hasListener(e)){that.addListener(e,dom,delegate);listeners[e]=[]}if(!hasTarget(e,selector)){listeners[e].push(buildTarget(selector,fn))}})};this.off=function(evt,selector,fn){each(extractEvents(evt),function(i,e){if(hasListener(e)){var target=hasTarget(e,selector,fn);if(target){listeners[e].splice(listeners[e].indexOf(target),1);if(listeners[e].length===0){that.removeListener(e,dom,delegate);delete listeners[e]}}}})};this.trigger=function(evt,selector){if(isHTMLElement(selector)===true||selector===window||selector===document){each(extractEvents(evt),function(i,e){dispatchEvent(createEvent(e),selector)});return}var elements=find(selector);if(getTypeOf(elements)!=="array"){elements=[elements]}if(elements.length>0){var shared={};each(extractEvents(evt),function(i,e){if(listeners[e]!==undefined){each(getAllTargets(e,selector),function(i,target){each(elements,function(i,element){var event=createEvent(e);event.preventDefault=function(){shared.returnValue=false};target.fn.call(element,event);return shared.returnValue});return shared.returnValue})}})}};this.clear=function(){for(var evt in listeners){this.removeListener(evt,dom,delegate)}listeners={};controllers.init()}};var controllers=new function(){var storage={};var that=this;function hasController(name){return storage[name]!==undefined?true:false}this.add=function(name){if(hasController(name)===true){throw"A controller with the name "+name+" has already been registered."}storage[name]=new Controller(name);return storage[name]};this.delegate=function(e,inHistory){var target=e.target;if(!target.getAttribute("no-follow")){var url=target.tagName==="FORM"?target.action:target.href;var method=target.tagName==="FORM"?target.method.toUpperCase():"GET";var action;var response;if(/#$/.test(url)){e.preventDefault();return}each(storage,function(i,ctrl){if(action=ctrl.hasMatchingAction(url,method)){e.preventDefault();var actionHistory=action.history;action.history=inHistory!==undefined?inHistory:actionHistory;action.run.call(action,e,url,method);action.history=actionHistory;response=false}});return response}};this.init=function(){events.on("click","[href]",that.delegate);events.on("submit","form",that.delegate)};initStorage.push(this.init)};var files=new function(){var processing={};this.include=function(url,callback,forcedType){if(!url){throw"No url given for file inclusion."}function getFileType(url){var TYPES={js:/\.js$/,css:/\.css$/};if(forcedType&&TYPES[forcedType]){return forcedType}for(var t in TYPES){if(TYPES[t].test(url)){return t}}throw"files.include allows you to include css or js files only"}function isIncluded(url,type){var tag=type==="js"?"script":"link";var attr=type==="js"?"src":"href";return typeof find(tag+"["+attr+'*="'+url+'"]')[0]!=="undefined"}function createFile(url,type){var tagName=type==="js"?"script":"link";var tagAttr=type==="js"?"src":"href";var tagType=type==="js"?"text/javascript":"text/css";var tagRel=type==="js"?null:"stylesheet";var file=document.createElement(tagName);file.type=tagType;file[tagAttr]=url;file.rel=tagRel;processing[url]=file;return file}function isProcessing(url){return typeof processing[url]!=="undefined"}function addWaitingCallback(url,callback){var processingFile=processing[url];if(processingFile){events.addListener("load",processingFile,function(){if(processing[url]){delete processing[url]}if(callback){callback()}})}}var file;var type=getFileType(url);if(isProcessing(url)===false&&isIncluded(url,type)===false){file=createFile(url,type)}else{file=processing[url]}if(isProcessing(url)){if(isIncluded(url,type)===false){first("head").appendChild(file)}if(callback){addWaitingCallback(url,callback)}}else{if(callback){callback()}}}};var historic=new function(){var callbacks=[];var index=-1;function updateUrl(url){window.history.pushState({index:index},"",url)}function loadEntry(index){if(callbacks[index]){callbacks[index]();return true}return false}this.addEntry=function(url,callback){if(window.history.pushState!==undefined){index++;if(callbacks.length-1>index){callbacks.splice(index,callbacks.length-index)}callbacks[index]=callback;updateUrl(url)}};this.init=function(){events.addListener("load",window,function(){setTimeout(function(){events.addListener("popstate",window,function(e){if(window.history.state){index=window.history.state.index;if(loadEntry(index)){return false}}if(redirect(window.location.href,false)!==undefined){return false}window.location.replace(window.location.href)})},1)})};initStorage.push(this.init)};var memory=new function(){var storage=localStorage||globalStorage||{};var rootName="app_memory";var root=storage[rootName]?JSON.parse(storage[rootName]):{};this.set=function(path,value){var ref=root;each(path.split("."),function(i,prop,len){if(i<len-1){if(ref[prop]===undefined){ref[prop]={}}ref=ref[prop]}else{ref[prop]=value}});storage[rootName]=JSON.stringify(root)};this.add=function(path,item){var collection=guessValueOf(path,root);if(getTypeOf(collection)!=="array"){throw path+" is not an array."}collection.push(item);storage[rootName]=JSON.stringify(root)};this.get=function(path){return guessValueOf(path,root)};this.remove=function(path){var ref=root;each(path.split("."),function(i,prop,len){if(i<len-1){if(ref[prop]!==undefined){ref=ref[prop]}}else{delete ref[prop]}});storage[rootName]=JSON.stringify(root)};this.clear=function(){root={};delete storage[rootName]}};var modelStorage={};var models=new function(){this.add=function(name,model){if(modelStorage[name]){throw'Model with name "'+name+'" is already registered.'}else if(getTypeOf(model)!=="object"){throw"Model must be an JSON."}modelStorage[name]=new Model(model);return modelStorage[name]};this.get=function(name){if(!modelStorage[name]){throw'Model with name "'+name+'" is not registered.'}return modelStorage[name]}};var overrides=new function(){var init=function(){if(typeof HTMLElement.prototype.up!=="function"){HTMLElement.prototype.up=function(){return up(this)}}else{throw"HTMLElement already have an up() method."}};initStorage.push(init)};var pager=new function(){var responses={};this.hasResponse=function(url){return typeof responses[url]!=="undefined"};this.addResponse=function(url,response){if(!this.hasResponse(url)){responses[url]=response}};this.getResponse=function(url){if(this.hasResponse(url)){return responses[url]}return null};this.removeResponse=function(url){if(this.hasResponse(url)){delete responses[url]}};this.clear=function(){responses={}}};var services=new function(){var container={};function hasService(name){return container[name]!==undefined}this.add=function(name,obj){if(hasService(name)){throw'A service with name "'+name+'" has already been registered.'}container[name]=obj;return this};this.get=function(name){if(hasService(name)===false){throw'Service "'+name+'" was not found.'}return container[name]}};var stage=new function(){var effectsIn=[];var effectsOut=[];var elementsIn=[];var elementsOut=[];this.effectIn=function(element,effect){if(element&&effect){if(elementsIn.indexOf(element)===-1){elementsIn.push(element);effectsIn.push(effect)}}};this.effectOut=function(element,effect){if(element&&effect){if(elementsOut.indexOf(element)===-1){elementsOut.push(element);effectsOut.push(effect)}}};this.handleEntering=function(element,callback){var index=elementsIn.indexOf(element);if(index!==-1&&isInDOM(element)){element.up()[effectsIn[index]](null,callback)}else{if(callback){callback()}}};this.handleLeaving=function(element,callback){var index=elementsOut.indexOf(element);if(index!==-1&&isInDOM(element)){element.up()[effectsOut[index]](null,callback)}else{if(callback){callback()}}}};var views=new function(){var storage={};this.add=function(name,params,context){if(storage[name]){throw'View with name "'+name+'" is already registered.'}else if(getTypeOf(params)!=="object"){throw"View params must be a JSON."}else if(context&&getTypeOf(context)!=="object"&&getTypeOf(context)!=="array"){throw"View context must be JSON or an array of JSON"}storage[name]=new View(params,context);return storage[name]};this.get=function(name){if(!storage[name]){throw'View with name "'+name+'" is not registered.'}return storage[name]}};each(initStorage,function(i,initFunc){initFunc()});events.addListener("load",window,function(){redirect(window.location.href,false)});return{authors:authors,version:version,channel:channel,controllers:controllers,events:events,files:files,models:models,views:views,memory:memory,services:services,el:el,find:find,first:first,redirect:redirect,request:request}});