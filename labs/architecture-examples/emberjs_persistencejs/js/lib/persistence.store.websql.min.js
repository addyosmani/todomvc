try{window||(window={})}catch(e){window={},exports.console=console}var persistence=window&&window.persistence?window.persistence:{};persistence.store||(persistence.store={}),persistence.store.websql={},persistence.store.websql.config=function(a,b,c,d){var e=null;a.transaction=function(a){if(!e)throw new Error("No ongoing database connection, please connect first.");e.transaction(a)},a.db=a.db||{},a.db.implementation="unsupported",a.db.conn=null;if(window&&window.openDatabase)a.db.implementation="html5";else if(window&&window.google&&google.gears)a.db.implementation="gears";else try{openDatabaseSync&&(a.db.implementation="html5-sync")}catch(f){}a.db.html5={},a.db.html5.connect=function(b,c,d){var e={},f=openDatabase(b,"1.0",c,d);return e.transaction=function(b){return f.transaction(function(c){return b(a.db.html5.transaction(c))})},e},a.db.html5.transaction=function(b){var c={};return c.executeSql=function(c,d,e,f){a.debug&&console.log(c,d),b.executeSql(c,d,function(a,b){if(e){var c=[];for(var d=0;d<b.rows.length;d++)c.push(b.rows.item(d));e(c)}},f)},c},a.db.html5Sync={},a.db.html5Sync.connect=function(b,c,d){var e={},f=openDatabaseSync(b,"1.0",c,d);return e.transaction=function(b){return f.transaction(function(c){return b(a.db.html5Sync.transaction(c))})},e},a.db.html5Sync.transaction=function(b){var c={};return c.executeSql=function(c,d,e,f){d==null&&(d=[]),a.debug&&console.log(c,d);var g=b.executeSql(c,d);if(g&&e){var h=[];for(var i=0;i<g.rows.length;i++)h.push(g.rows.item(i));e(h)}},c},a.db.gears={},a.db.gears.connect=function(b){var c={},d=google.gears.factory.create("beta.database");return d.open(b),c.transaction=function(b){b(a.db.gears.transaction(d))},c},a.db.gears.transaction=function(b){var c={};return c.executeSql=function(c,d,e,f){a.debug&&console.log(c,d);var g=b.execute(c,d);if(e){var h=[];while(g.isValidRow()){var i={};for(var j=0;j<g.fieldCount();j++)i[g.fieldName(j)]=g.field(j);h.push(i),g.next()}e(h)}},c},a.db.connect=function(b,c,d){if(a.db.implementation=="html5")return a.db.html5.connect(b,c,d);if(a.db.implementation=="html5-sync")return a.db.html5Sync.connect(b,c,d);if(a.db.implementation=="gears")return a.db.gears.connect(b)},a.store.websql.sqliteDialect={createTable:function(b,c){var d=a.typeMapper,e="CREATE TABLE IF NOT EXISTS `"+b+"` (",f=[];for(var g=0;g<c.length;g++){var h=c[g];f.push("`"+h[0]+"` "+d.columnType(h[1])+(h[2]?" "+h[2]:""))}return e+=f.join(", "),e+=")",e},createIndex:function(a,b,c){return c=c||{},"CREATE "+(c.unique?"UNIQUE ":"")+"INDEX IF NOT EXISTS `"+a+"__"+b.join("_")+"` ON `"+a+"` ("+b.map(function(a){return"`"+a+"`"}).join(", ")+")"}},a.store.sql.config(a,a.store.websql.sqliteDialect),e=a.db.connect(b,c,d);if(!e)throw new Error("No supported database found in this browser.")};try{exports.persistence=persistence}catch(e){}
